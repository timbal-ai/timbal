{
  "openapi": "3.1.0",
  "info": {
    "title": "Timbal Platform API",
    "description": "Public API documentation for the Timbal platform",
    "license": {
      "name": ""
    },
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://dev.timbal.ai"
    }
  ],
  "paths": {
    "/orgs/{org_id}/embedding-models": {
      "get": {
        "tags": [
          "embeddings"
        ],
        "description": "List all available embedding models for the organization",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Array of embedding models",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListEmbeddingModelsResBody"
                },
                "example": {
                  "embedding_models": [
                    "text-embedding-ada-002",
                    "text-embedding-3-small",
                    "text-embedding-3-large"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/orgs/{org_id}/kbs/{kb_id}/embeddings": {
      "get": {
        "tags": [
          "embeddings"
        ],
        "description": "List embeddings",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "table_name",
            "in": "query",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Embeddings listed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListEmbeddingsResBody"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      },
      "post": {
        "tags": [
          "embeddings"
        ],
        "description": "Create a new embedding",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateEmbeddingReqBody"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Embedding created successfully"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/orgs/{org_id}/kbs/{kb_id}/embeddings/{embedding_name}": {
      "delete": {
        "tags": [
          "embeddings"
        ],
        "description": "Delete an embedding",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "embedding_name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Embedding deleted successfully"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/orgs/{org_id}/kbs/{kb_id}/indexes": {
      "get": {
        "tags": [
          "indexes"
        ],
        "description": "List indexes for a KB",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "table_name",
            "in": "query",
            "description": "Table name to filter indexes by",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Array of indexes",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListIndexesResBody"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      },
      "post": {
        "tags": [
          "indexes"
        ],
        "description": "Create a new index on a table",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateIndexReqBody"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Index created successfully"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/orgs/{org_id}/kbs/{kb_id}/indexes/{index_name}": {
      "delete": {
        "tags": [
          "indexes"
        ],
        "description": "Delete an index",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "index_name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Index deleted successfully"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/orgs/{org_id}/kbs/{kb_id}/tables/{table_name}/csv": {
      "post": {
        "tags": [
          "tables"
        ],
        "description": "Insert or update rows into a table from a CSV file",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "table_name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/csv": {

            }
          }
        },
        "responses": {
          "204": {
            "description": "Rows inserted successfully"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/orgs/{org_id}/kbs/{kb_id}/tables/{table_name}/records": {
      "post": {
        "tags": [
          "tables"
        ],
        "description": "Insert or update records into a table",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "table_name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpsertRecordsReqBody"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Records upserted successfully"
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    },
    "/orgs/{org_id}/kbs/{kb_id}/tables/{table_name}/search": {
      "post": {
        "tags": [
          "tables"
        ],
        "description": "Search for records in a table",
        "operationId": "handler",
        "parameters": [
          {
            "name": "org_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "kb_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "table_name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchTableReqBody"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Array of records matching the search query. Structure depends on the table schema and selected columns.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {

                  }
                },
                "example": [
                  {
                    "id": 1,
                    "name": "Alice Johnson",
                    "email": "alice@example.com"
                  },
                  {
                    "id": 2,
                    "name": null,
                    "email": "bob@example.com"
                  },
                  {
                    "id": 3,
                    "name": "Carol",
                    "email": "carol@example.com"
                  }
                ]
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "CreateEmbeddingReqBody": {
        "type": "object",
        "required": [
          "name",
          "table_name",
          "column_name",
          "model",
          "with_gin_index"
        ],
        "properties": {
          "column_name": {
            "type": "string",
            "description": "Name of the source column"
          },
          "model": {
            "$ref": "#/components/schemas/EmbeddingModel",
            "description": "Embedding model to use. See the list embedding models endpoint for available options."
          },
          "name": {
            "type": "string",
            "description": "Name of the embedding"
          },
          "table_name": {
            "type": "string",
            "description": "Name of the source table"
          },
          "with_gin_index": {
            "type": "boolean",
            "description": "Whether to create a GIN index for the source column for faster hybrid search"
          }
        }
      },
      "CreateIndexReqBody": {
        "type": "object",
        "required": [
          "table_name",
          "name",
          "column_names",
          "type",
          "is_unique"
        ],
        "properties": {
          "column_names": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of column names to index. At least one column is required. Multiple columns will create a composite index"
          },
          "is_unique": {
            "type": "boolean",
            "description": "Whether the index should enforce uniqueness"
          },
          "name": {
            "type": "string",
            "description": "Index name. This must be unique in the entire Knowledge Base"
          },
          "table_name": {
            "type": "string",
            "description": "Table name"
          },
          "type": {
            "$ref": "#/components/schemas/IndexType",
            "description": "Index type"
          }
        }
      },
      "Embedding": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EmbeddingStatus"
          },
          {
            "type": "object",
            "required": [
              "id",
              "name",
              "table_name",
              "column_name",
              "model",
              "created_at",
              "updated_at"
            ],
            "properties": {
              "column_name": {
                "type": "string"
              },
              "created_at": {
                "type": "string",
                "format": "date-time"
              },
              "id": {
                "type": "integer",
                "format": "int64"
              },
              "model": {
                "$ref": "#/components/schemas/EmbeddingModel"
              },
              "name": {
                "type": "string"
              },
              "table_name": {
                "type": "string"
              },
              "updated_at": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        ]
      },
      "EmbeddingModel": {
        "type": "string"
      },
      "EmbeddingStatus": {
        "oneOf": [
          {
            "type": "object",
            "required": [
              "details",
              "status"
            ],
            "properties": {
              "details": {
                "type": "object"
              },
              "status": {
                "type": "string",
                "enum": [
                  "pending"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "details",
              "status"
            ],
            "properties": {
              "details": {
                "type": "object",
                "properties": {
                  "processed_rows": {
                    "type": [
                      "integer",
                      "null"
                    ],
                    "format": "int64"
                  },
                  "total_rows": {
                    "type": [
                      "integer",
                      "null"
                    ],
                    "format": "int64"
                  }
                }
              },
              "status": {
                "type": "string",
                "enum": [
                  "processing"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "details",
              "status"
            ],
            "properties": {
              "details": {
                "type": "object"
              },
              "status": {
                "type": "string",
                "enum": [
                  "success"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "details",
              "status"
            ],
            "properties": {
              "details": {
                "type": "object",
                "required": [
                  "error"
                ],
                "properties": {
                  "error": {
                    "type": "string"
                  }
                }
              },
              "status": {
                "type": "string",
                "enum": [
                  "error"
                ]
              }
            }
          }
        ]
      },
      "Index": {
        "type": "object",
        "required": [
          "table",
          "name",
          "columns",
          "type",
          "is_unique",
          "definition"
        ],
        "properties": {
          "columns": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "definition": {
            "type": "string"
          },
          "is_unique": {
            "type": "boolean"
          },
          "name": {
            "type": "string"
          },
          "table": {
            "type": "string"
          },
          "type": {
            "$ref": "#/components/schemas/IndexType"
          }
        }
      },
      "IndexType": {
        "type": "string",
        "enum": [
          "btree",
          "hash",
          "gin",
          "gist",
          "brin",
          "hnsw"
        ]
      },
      "ListEmbeddingModelsResBody": {
        "type": "object",
        "required": [
          "embedding_models"
        ],
        "properties": {
          "embedding_models": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EmbeddingModel"
            }
          }
        }
      },
      "ListEmbeddingsResBody": {
        "type": "object",
        "required": [
          "embeddings"
        ],
        "properties": {
          "embeddings": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Embedding"
            }
          }
        }
      },
      "ListIndexesResBody": {
        "type": "object",
        "required": [
          "indexes"
        ],
        "properties": {
          "indexes": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Index"
            }
          }
        }
      },
      "SearchTableReqBody": {
        "type": "object",
        "required": [
          "query",
          "embedding_names"
        ],
        "properties": {
          "embedding_names": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of embedding names to use for semantic search. Only a single column is supported at the moment."
          },
          "fts_columns": {
            "type": [
              "array",
              "null"
            ],
            "items": {
              "type": "string"
            },
            "description": "List of column names to use for full-text search. When specified together with embedding_names, search will be hybrid (both semantic and full-text)."
          },
          "limit": {
            "type": "integer",
            "format": "int64",
            "description": "Maximum number of results to return.",
            "default": 10
          },
          "offset": {
            "type": "integer",
            "format": "int64",
            "description": "Number of results to skip before returning.",
            "default": 0
          },
          "query": {
            "type": "string",
            "description": "Semantic search query."
          },
          "select_columns": {
            "type": [
              "array",
              "null"
            ],
            "items": {
              "type": "string"
            },
            "description": "List of column names to return in the search results. When not specified, all columns will be returned."
          },
          "where": {
            "type": [
              "string",
              "null"
            ],
            "description": "SQL WHERE expression to apply to the search. This feature is _experimental_ and may be removed or changed in the future."
          }
        }
      },
      "UpsertRecordsReqBody": {
        "type": "object",
        "required": [
          "records"
        ],
        "properties": {
          "records": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": {

              },
              "propertyNames": {
                "type": "string"
              }
            },
            "description": "Array of records to insert or update (at least one record is required)"
          }
        }
      }
    },
    "securitySchemes": {
      "bearer_auth": {
        "type": "http",
        "scheme": "bearer",
        "description": "Timbal API key. Obtain your API key from the Timbal platform settings. See [Authentication](/api-reference/authentication) for more information."
      }
    }
  },
  "tags": [
    {
      "name": "embeddings",
      "description": "KB Embeddings operations"
    },
    {
      "name": "indexes",
      "description": "KB Indexes operations"
    },
    {
      "name": "tables",
      "description": "KB Tables operations"
    }
  ]
}